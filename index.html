<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Language" content="br" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>WHERE'S M'BUS? - Home</title>
    <link rel="shortcut-icon" href="favicon.ico" type="image/x-icon" />
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.51.0/mapbox-gl.js'></script>
    <script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v2.3.0/mapbox-gl-geocoder.min.js'></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.js"></script>
    <script type="text/javascript" src="js/functions.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v2.3.0/mapbox-gl-geocoder.css' type='text/css' />
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.50.0/mapbox-gl.css' rel='stylesheet' />
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" type="text/css" href="/css/home.css">
</head>

<body>
    <div class="wrap">
        <div class="logoIcon">
            <img src="assets/imgs/gps.png" width="30" height="40">
            <p class="textIcon">WHERE'S M'BUS?</p>
        </div>
    </div>

    <div id="search" class="geocoder"></div>

    <div id="divOption" class="opt">
        <label class="container"> Mostrar Linhas
            <input type="radio" onclick="plotLinhas(latitude, longitude)" name="option">
            <span class="checkmark"></span>
        </label>
        <label class="container"> Mostrar Paradas
            <input type="radio" name="option" onclick="plotParadas(latitude, longitude)">
            <span class="checkmark"></span>
        </label>
    </div>

    <div class="info">
        <p id="rcorners">
            <i class="fa fa-address-card-o"></i><br>
            Nome: Luan Sales<br>
            NºUSP: 9277468<br>
            Sem.: 2º/2018
        </p>
        <p id="rcorners">
            <i class="fa fa-address-card-o"></i><br>
            Nome: Hugo Boleta<br>
            NºUSP: 7650972<br>
            Sem.: 2º/2018
        </p>
    </div>

    <div id="update-div" hidden class="upt">
        <button class="btn" onclick="updateMap(latitude, longitude)"><i class="fa fa-refresh"></i> Atualizar</button>
        <button class="btn" onclick="centralizeMap(oLatitude, oLongitude)"><i class="fa fa-crosshairs"></i> Centralizar</button>
    </div>

    <div id='map'></div>

    <div class="footer">
        <p>ACH2077[2018] - Soluções Web Baseadas em Software Livre</p>
    </div>

    <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoibXVsYW5zYWxlcyIsImEiOiJjam44eGxnbTkwaWQwM3Fud3FkdTJxNnJrIn0.RzA6ZoACN112nCb10JqDlw';

        var geolocation = new mapboxgl.GeolocateControl();

        var oLatitude;
        var oLongitude;

        var latitude;
        var longitude;

        // If geolocation is enabled
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
                function(position) {
                    latitude = position.coords.latitude;
                    oLatitude = position.coords.latitude;
                    longitude = position.coords.longitude;
                    oLongitude = position.coords.longitude;

                    map = new mapboxgl.Map({
                        container: 'map',
                        style: 'mapbox://styles/mapbox/streets-v9',
                        center: [longitude, latitude],
                        zoom: 12
                    });

                    map.addControl(new mapboxgl.NavigationControl());

                    var scale = new mapboxgl.ScaleControl({
                        maxWidth: 80,
                        unit: 'metric'
                    });
                    map.addControl(scale);

                    map.addControl(geolocation);

                    map.flyTo({
                        center: [longitude, latitude],
                        zoom: 12
                    });

                    var geocoder = new MapboxGeocoder({
                        accessToken: mapboxgl.accessToken,
                        country: "br",
                        // Itapevi, Franco da Rocha, Mogi das Cruzes, Cubatão
                        bbox: [-46.93416666666666, -23.895, -46.1883333333333, -23.30527777777778]
                    });

                    document.getElementById('search').appendChild(geocoder.onAdd(map));

                    map.on('load', function() {
                        map.addSource('single-point', {
                            "type": "geojson",
                            "data": {
                                "type": "FeatureCollection",
                                "features": []
                            }
                        });

                        map.addLayer({
                            "id": "single",
                            "source": "single-point",
                            "type": "circle",
                            "paint": {
                                "circle-radius": 10,
                                "circle-color": "#00B4CC"
                            }
                        });

                        geocoder.on('result', function(ev) {
                            map.getSource('single-point').setData(null);
                            map.getSource('single-point').setData(ev.result.geometry);

                            longitude = ev.result.center[0];
                            latitude = ev.result.center[1];

                            document.getElementById('update-div').style.display = 'none';
                            var radio = document.getElementsByName("option");
                            for (var i = 0; i < radio.length; i++)
                                radio[i].checked = false;
                        });
                    });
                }
            );
        }

        geolocation.on('geolocate', function(e) {
            map.flyTo({
                center: [longitude, latitude],
                zoom: 16 //set zoom
            });
        });
    </script>

</body>

</html>
